(()=>{"use strict";var e={openPopupClass:"popup_is-opened",animatedPopupClass:"popup_is-animated"};function t(t){t.classList.add(e.animatedPopupClass),setTimeout((function(){t.classList.add(e.openPopupClass)}),0),document.addEventListener("keydown",o),document.addEventListener("mousedown",r)}function n(t){t.classList.remove(e.openPopupClass),setTimeout((function(){t.classList.remove(e.animatedPopupClass)}),600),document.removeEventListener("keydown",o),document.removeEventListener("mousedown",r)}function o(t){"Escape"===t.key&&n(document.querySelector("."+e.openPopupClass))}function r(t){t.target.classList.contains(e.openPopupClass)&&n(t.target)}var c={baseUrl:"https://nomoreparties.co/v1/wff-cohort-1",headers:{authorization:"d49f8c35-874e-409a-8e48-d7efdaa466d1","Content-Type":"application/json"}};function a(e){return fetch(c.baseUrl+e,{headers:c.headers}).then(i)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return fetch(c.baseUrl+e,{method:n,headers:c.headers,body:JSON.stringify(t)}).then(i)}var i=function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))},s=document.querySelector("#card-template").content;function l(e,t,n,o,r){var c=s.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__delete-button"),u=c.querySelector(".card__image"),i=c.querySelector(".card__title"),l=c.querySelector(".card__like-button"),d=c.querySelector(".card__like-counter");return c.id=e._id,r!==e.owner._id?a.style="display: none":a.addEventListener("click",(function(){t(e)})),p(e,r)?l.classList.add("card__like-button_is-active"):l.classList.remove("card__like-button_is-active"),u.src=e.link,u.alt=e.name,i.textContent=e.name,d.textContent=e.likes.length,u.addEventListener("click",n),l.addEventListener("click",(function(){o(e,r)})),c}function d(e,t){var n=document.getElementById(e._id),o=n.querySelector(".card__like-button"),r=n.querySelector(".card__like-counter");p(e,t)?u("/cards/likes/".concat(e._id),{},"DELETE").then((function(t){r.textContent=t.likes.length,o.classList.remove("card__like-button_is-active"),e.likes=t.likes})).catch((function(e){console.log(e)})):u("/cards/likes/".concat(e._id),{},"PUT").then((function(t){r.textContent=t.likes.length,o.classList.add("card__like-button_is-active"),e.likes=t.likes})).catch((function(e){console.log(e)}))}function p(e,t){return e.likes.some((function(e){return e._id===t}))}function m(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function f(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)}function _(e,t){e.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass),Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){m(e,n,t)}))}var v=document.querySelector(".places__list"),y=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),h=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),q=document.querySelector(".popup_avatar"),E=document.forms["change-avatar"],L=E.elements.link,b=q.querySelector(".popup__button"),g=document.querySelector(".popup_type_edit"),x=document.forms["edit-profile"],P=x.elements.name,T=x.elements.description,A=g.querySelector(".popup__button"),B=document.querySelector(".popup_type_new-card"),w=document.forms["new-place"],D=w.elements["place-name"],I=w.elements.link,U=B.querySelector(".popup__button"),j=document.querySelector(".popup_type_image"),M=document.querySelector(".popup__image"),H=document.querySelector(".popup__caption"),N=document.querySelector(".popup_delete-image"),O=N.querySelector(".popup__button"),V=document.querySelectorAll(".popup__close"),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},J="";function F(e){M.src=e.target.src,M.alt=e.target.alt,H.textContent=e.target.alt,t(j)}function G(e){t(N);var o=O.dataset.cardId=e._id;O.addEventListener("click",(function(){u("/cards/".concat(o),{},"DELETE").then((function(){var e=document.getElementById(o);O.dataset.cardId="",e.remove(),n(N)})).catch((function(e){return console.log(e)}))}))}function K(e,t){t.textContent=e?"Сохранение...":t.dataset.buttonText}Promise.all([a("/cards"),a("/users/me")]).then((function(e){J=e[1]._id,h.textContent=e[1].name,C.textContent=e[1].about,k.style="background-image: url('".concat(e[1].avatar,"')"),e[0].forEach((function(e){v.append(l(e,G,F,d,J))}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);f(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?m(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.classList.add(o.errorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),f(n,o,t)}))}))}(t,e)}))}(z),k.addEventListener("click",(function(){t(q)})),y.addEventListener("click",(function(){P.value=h.textContent,T.value=C.textContent,_(x,z),t(g)})),S.addEventListener("click",(function(){w.reset(),_(B,z),t(B)})),V.forEach((function(e){e.addEventListener("click",(function(e){n(e.target.closest(".popup"))}))})),E.addEventListener("submit",(function(e){e.preventDefault(),K(!0,b),u("/users/me/avatar",{avatar:L.value},"PATCH").then((function(e){k.style="background-image: url('".concat(e.avatar,"')")})).catch((function(e){return console.log(e)})).finally((function(){K(!1,b),n(q),E.reset()}))})),x.addEventListener("submit",(function(e){e.preventDefault(),K(!0,A),u("/users/me",{name:P.value,about:T.value},"PATCH").then((function(e){h.textContent=e.name,C.textContent=e.about})).catch((function(e){return console.log(e)})).finally((function(){K(!1,A),n(g)}))})),w.addEventListener("submit",(function(e){e.preventDefault(),K(!0,U),u("/cards",{name:D.value,link:I.value}).then((function(e){v.prepend(l(e,G,F,d,J))})).catch((function(e){return console.log(e)})).finally((function(){K(!1,U),n(B),w.reset()}))}))})();